<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="alz.order.mapper.MerchandiseMapper">


	<insert id="insert"
		parameterType="alz.order.domain.MerchandiseDTO">
		<selectKey keyProperty="id" order="BEFORE" resultType="long">
			SELECT alz_merchandise_detail_seq.nextval FROM dual
		</selectKey>
		INSERT INTO
		alz_merchandise_detail(
		ID, CODE_TYPE, NAME, DESCRIPTION,
		CLOSED_AT,
		ORIGIN_PRICE, SALE_PRICE, DISCOUNT_RATE, DISCOUNT_DEADLINE,
		DISPLAY_STATE, REF_ID, MERCHANDISE_ID
		)
		VALUES (
		#{id}, #{codeType},
		#{name}, #{description}, #{closedAt},
		#{originPrice},#{salePrice},#{discountRate}, #{discountDeadline},
		#{displayState}, #{refId}, #{merchandiseId}
		)
	</insert>

	<select id="selectById"
		resultType="alz.order.domain.MerchandiseDTO">
		SELECT * FROM ALZ_MERCHANDISE_DETAIL WHERE id = #{id}
	</select>

	<select id="selectAll"
		resultType="alz.order.domain.MerchandiseDTO">
		SELECT * FROM ALZ_MERCHANDISE_DETAIL
	</select>

	<update id="updateById"
		parameterType="alz.order.domain.MerchandiseDTO">
		UPDATE ALZ_MERCHANDISE_DETAIL
		SET
		CODE_TYPE = #{codeType},
		NAME = #{name},
		DESCRIPTION = #{description},
		UPDATED_AT
		= sysdate,
		CLOSED_AT = #{closedAt},
		ORIGIN_PRICE = #{originPrice},
		SALE_PRICE =
		#{salePrice},
		DISCOUNT_RATE = #{discountRate},
		DISCOUNT_DEADLINE =
		#{discountDeadline},
		DISPLAY_STATE =
		#{displayState}
		WHERE id = #{id}
	</update>

	<update id="update"
		parameterType="alz.order.domain.MerchandiseDTO">
		UPDATE ALZ_MERCHANDISE_DETAIL
		SET
		CODE_TYPE = #{codeType},
		NAME = #{name},
		DESCRIPTION = #{description},
		UPDATED_AT
		= sysdate,
		CLOSED_AT = #{closedAt},
		ORIGIN_PRICE = #{originPrice},
		SALE_PRICE =
		#{salePrice},
		DISCOUNT_RATE = #{discountRate},
		DISCOUNT_DEADLINE =
		#{discountDeadline},
		DISPLAY_STATE =
		#{displayState}
		WHERE id = #{id}
	</update>

	<delete id="deleteById">
		DELETE FROM ALZ_MERCHANDISE_DETAIL WHERE id = #{id}
	</delete>


	<sql id="criteria">
		<trim prefix="(" suffix=") AND " prefixOverrides="OR">
			<foreach item='type' collection="typeArr">
				<trim prefix="OR">
					<choose>
						<when test="type == 'T'.toString()">
							CODE_TYPE like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'C'.toString()">
							name like '%'||#{keyword}||'%'
						</when>
						<when test="type == 'W'.toString()">
							DESCRIPTION like '%'||#{keyword}||'%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>

	<select id="getListWithPaging"
		resultType="alz.order.domain.MerchandiseDTO">
	<![CDATA[
  select 
    id, code_Type, name, origin_Price
  from 
      (
      select /*+INDEX_DESC(alz_merchandise_detail pk_id) */
        rownum rn, id, code_Type, name, origin_Price
      from 
        alz_merchandise_detail
      where 
     
  ]]>

		<include refid="criteria"></include>
	
	<![CDATA[
		 rownum <= #{pageNum} * #{amount}
      )
  		where rn > (#{pageNum} -1) * #{amount}
  	]]>

	</select>

	<select id="getTotalCount" resultType="int">
		SELECT count(*) from
		alz_merchandise_detail where

		<include refid="criteria"></include>
		id > 0

	</select>




</mapper>